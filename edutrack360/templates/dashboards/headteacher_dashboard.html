{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Headteacher Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/headteacher_dashboard.css' %}">
</head>
<body>
    <div class="navbar">
        <div class="logo">
        <a href="{% url 'dashboards:headteacher_dashboard' %}">
            <img src="{% static 'edutrack logo official.png' %}" alt="Edutrack360 Logo" class="logo-img">
        </a>
        </div>
        <div class="navbar-icons">
            <i class="fas fa-bell"></i>
            <i class="fas fa-user-circle"></i>
            <span class="welcome-text">Welcome, {{ user.first_name }}</span>
        </div>
    </div>

    <div class="sidebar">
        <a href="{% url 'dashboards:headteacher_dashboard' %}">
            <i class="fas fa-tachometer-alt"></i>
            <span class="tooltip">Dashboard</span>
        </a>
        <a href="{% url 'school:teacher_management' %}">
            <i class="fas fa-chalkboard-teacher"></i>
            <span class="tooltip">Teacher Management</span>
        </a>
        <a href="{% url 'school:class_management' %}">
            <i class="fas fa-school"></i>
            <span class="tooltip">Class Management</span>
        </a>
        <a href="{% url 'school:subject_management' %}">
            <i class="fas fa-book-medical me-2"></i>
            <span class="tooltip">Subject Management</span>
        </a>
        <a href="{% url 'school:school_performance_analysis' %}">
            <i class="fas fa-chart-bar"></i>
            <span class="tooltip">School Performance Analysis</span>
        </a>
        <a href="{% url 'school:progress_trends' %}">
            <i class="fas fa-chart-line"></i>
            <span class="tooltip">Progress & Trends</span>
        </a>
        <a href="{% url 'school:submit_results' %}">
            <i class="fas fa-file-upload"></i>
            <span class="tooltip">Submit Results</span>
        </a>
        <a href="{% url 'logout' %}" class="logout-link">
            <i class="fas fa-sign-out-alt"></i>
            <span class="tooltip">Logout</span>
        </a>
    </div>

    <div class="main-content">
        <div class="dashboard-header text-center text-md-start">
            <h4 class="fw-bold">
                {{ request.user.school|default:"Your" }} Dashboard
            </h4>
        </div>
        
        <div class="container mt-4">
            <div class="row g-3">
                <!-- Total Students Assessed -->
                <div class="col-md-6">
                    <div class="dashboard-card total-students-assessed" >
                        <div>
                            <h3>Total Students Assessed</h3>
                            <p class="value">{{ total_students_assessed }}</p>
                        </div>
                        <div class="icon"><i class="fas fa-users"></i></div>
                    </div>
                </div>
                
                <!-- Total School Average -->
                <div class="col-md-6">
                    <div class="dashboard-card average-class-performance">
                        <div>
                            <h3>Average School Performance</h3>
                            <p class="value">{{ total_school_average|floatformat:2 }}%</p>
                        </div>
                        <div class="icon"><i class="fas fa-chart-line"></i></div>
                    </div>
                </div>

                <!-- Total Teachers -->
                <div class="col-md-6">
                    <div class="dashboard-card total-teachers">
                        <div>
                            <h3>Total Teachers in the School</h3>
                            <p class="value">{{ total_school_average|floatformat:2 }}%</p>
                        </div>
                        <div class="icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    </div>
                </div>

                <!-- Best Performing Subjects -->
                <div class="col-md-6">
                    <div class="dashboard-card best-performing-subject">
                        <div>
                            <h3>Best Two Performing Subjects</h3>
                            {% for subject in best_performing_subjects %}
                                <p class="value">{{ subject.result__subject__name }} - {{ subject.result__subject__department__name }}</p>
                            {% empty %}
                                <p class="value">No data available</p>
                            {% endfor %}
                        </div>
                        <div class="icon"><i class="fas fa-trophy"></i></div>
                    </div>
                </div>

                <!-- Worst Performing Subjects -->
                <div class="col-md-6">
                    <div class="dashboard-card weakest-performing-subject">
                        <div>
                            <h3>Weakest Two Performing Subjects</h3>
                            {% for subject in worst_performing_subjects %}
                                <p class="value">{{ subject.result__subject__name }} - {{ subject.result__subject__department__name }}</p>
                            {% empty %}
                                <p class="value">No data available</p>
                            {% endfor %}
                        </div>
                        <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
                    </div>
                </div>

                <!-- Best Performing Classes -->
                <div class="col-md-6">
                    <div class="dashboard-card best-performing-classes">
                        <div>
                            <h3>Top Three Performing Classes</h3>
                            {% for class in best_performing_classes %}
                                <p class="value">{{ class.result__student__class_group__name }} - {{ class.avg_score|floatformat:2 }}%</p>
                            {% empty %}
                                <p class="value">No data available</p>
                            {% endfor %}
                        </div>
                        <div class="icon"><i class="fas fa-star"></i></div>
                    </div>
                </div>

                <!-- School Performance Trends -->
                <div class="col-md-12">
                    <div class="custom-card">
                        <div class="card-header">School Performance Trends</div>
                        <div class="card-body">
                            <canvas id="performanceTrendsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="col-md-12">
                    <div class="custom-card">
                        <div class="card-header">Recent Uploads</div>
                        <div class="card-body">
                            {% if notifications %}
                                <ul>
                                    {% for notification in notifications %}
                                        <li>{{ notification.teacher__full_name }} uploaded {{ notification.subject__name }} results for {{ notification.student__class_group__name }}</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>No recent uploads.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var ctx = document.getElementById('performanceTrendsChart').getContext('2d');
            var performanceTrendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: JSON.parse('{{ performance_trends.dates|safe }}'),
                    datasets: [{
                        label: 'School Performance Trend',
                        data: JSON.parse('{{ performance_trends.scores|safe }}'),
                        borderColor: 'blue',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        });
    </script>

</body>
</html>
