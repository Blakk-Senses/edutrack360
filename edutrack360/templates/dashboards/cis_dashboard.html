{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>District Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/cis_dashboard.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
  <div class="navbar">
      <div class="logo">
        <a href="{% url 'dashboards:cis_dashboard' %}" class="href">
          <img src="{% static 'edutrack logo official.png' %}" alt="Edutrack360 Logo" class="logo-img">
        </a>
      </div>
      <div class="navbar-icons">
          <i class="fas fa-bell"></i>
          <i class="fas fa-user-circle"></i>
          <span class="welcome-text">Welcome , Chief Inspector {{ user.first_name }}</span>
      </div>
    </div>
    
  </div>
  
    <div class="sidebar">
        <a href="{% url 'dashboards:cis_dashboard' %}">
            <i class="fas fa-tachometer-alt"></i>
            <span class="tooltip">Dashboard</span>
        </a>
        <a href="{% url 'cis:school_management' %}">
            <i class="fas fa-school"></i>
            <span class="tooltip">School Management</span>
        </a>
        <a href="{% url 'cis:siso_management' %}">
            <i class="fas fa-tasks"></i>
            <span class="tooltip">SISO Management</span>
        </a>
        <a href="{% url 'cis:generate_reports' %}">
            <i class="fas fa-file-alt"></i>
            <span class="tooltip">Generate Reports</span>
        </a>
        <a href="{% url 'cis:send_notification' %}">
            <i class="fas fa-bell"></i>
            <span class="tooltip">Send Notifications</span>
        </a>
        <a href="{% url 'cis:user_management' %}">
            <i class="fas fa-users-cog"></i>
            <span class="tooltip">User Management</span>
        </a>
        
        </a>
        <a href="{% url 'logout_prompt' %}" class="logout-link">
            <i class="fas fa-sign-out-alt"></i>
            <span class="tooltip">Logout</span>
        </a>
    </div>

    <div class="main-content">
        <div class="dashboard-header text-center text-md-start" style="margin-bottom: 0px; padding: 2px 0;">
            <h4 class="fw-bold" style="margin: 0;">
                {{ request.user.district|default:"Your" }} District Dashboard
            </h4>
        </div>
        <div class="container" style="margin-top: 0px;">
            <div class="row g-2">
                <!-- Existing Cards -->
                <div class="col-md-6">
                    <div class="dashboard-card total-schools">
                        <div>
                            <h3>Total Schools in District</h3>
                            <p class="value">{{ total_schools|default:"0" }}</p>
                        </div>
                        <div class="icon"><i class="fas fa-school"></i></div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="dashboard-card total-teachers">
                        <div>
                            <h3>Total Teachers in District</h3>
                            <p class="value">{{ total_teachers|default:"0" }}</p>
                        </div>
                        <div class="icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="dashboard-card average-district-performance">
                        <div>
                            <h3>Average District Performance</h3>
                            <p class="value">{{ avg_district_performance|default:"0%" }}</p>
                        </div>
                        <div class="icon"><i class="fas fa-chart-bar"></i></div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="dashboard-card active-siso-tasks">
                        <div>
                            <h3>Active SISO Tasks</h3>
                            <p class="value">{{ active_siso_tasks|default:"0" }}</p>
                        </div>
                        <div class="icon"><i class="fas fa-tasks"></i></div>
                    </div>
                </div>

                <!-- District Performance Trends -->
                <div class="col-md-12">
                    <div class="custom-card">
                        <div class="card-header">Performance Trends</div>
                        <div class="card-body">
                            <canvas id="performanceTrendsChart"></canvas>
                        </div>
                    </div>
                </div>
        
                <!-- Top Performing Schools -->
                <div class="col-md-12">
                    <div class="custom-card">
                        <div class="card-header">Top Performing Schools</div>
                        <div class="card-body">
                            <ul class="list-group">
                                {% for school in top_schools %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ school.name }}
                                    <span class="badge badge-primary badge-pill">{{ school.performance_score }}%</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
        
                <!-- District Summary -->
                <div class="col-md-12">
                    <div class="custom-card">
                        <div class="card-header">District Summary</div>
                        <div class="card-body">
                            <p>{{ district_summary }}</p>
                        </div>
                    </div>
                </div>

                <!-- Active SISOs -->
                <div class="col-md-12">
                    <div class="custom-card">
                        <div class="card-header">Active SISOs</div>
                        <div class="card-body">
                            <ul class="list-group">
                                {% for siso in active_sisos %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ siso.name }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chart.js Script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Get data safely
        var performanceLabels = JSON.parse(document.getElementById('performance-labels').textContent);
        var performanceData = JSON.parse(document.getElementById('performance-data').textContent);

        // Setup the Performance Trends Chart
        var ctx = document.getElementById("performanceTrendsChart").getContext("2d");
        var performanceTrendsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: performanceLabels,
                datasets: [{
                    label: 'Performance',
                    data: performanceData,
                    backgroundColor: 'rgba(78, 115, 223, 0.1)',
                    borderColor: 'rgba(78, 115, 223, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: {
                            color: "rgba(234, 236, 244, 1)"
                        },
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        ticks: {
                            color: "rgba(234, 236, 244, 1)"
                        },
                        grid: {
                            color: "rgba(234, 236, 244, 1)"
                        }
                    }
                }
            }
        });
    </script>

</body>
</html>